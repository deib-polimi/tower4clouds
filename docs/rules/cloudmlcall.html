<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Tower 4Clouds</title>

    <link rel="stylesheet" href="http://deib-polimi.github.io/tower4clouds/css/bootstrap.min.css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="http://deib-polimi.github.io/tower4clouds/css/highlight.dark.css">
    <link rel="stylesheet" href="http://deib-polimi.github.io/tower4clouds/css/main.css">
</head>
<body class="">

<header class="navbar navbar-default navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <a href="http://deib-polimi.github.io/tower4clouds/" class="navbar-brand"><img src="http://deib-polimi.github.io/tower4clouds/img/logo-small.png" alt=""></a>
            <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-main">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        </div>

        <div class="navbar-collapse collapse" id="navbar-main">
            <ul class="nav navbar-nav navbar-right">
                <li><a href="http://deib-polimi.github.io/tower4clouds/">Home</a></li>
                <li><a href="http://deib-polimi.github.io/tower4clouds/docs/get-started.html">Get started</a></li>
                <li><a href="http://deib-polimi.github.io/tower4clouds/docs/">Documentation</a></li>
                                <li>
                    <a href="https://github.com/deib-polimi/tower4clouds">
                        <i class="fa fa-github"></i> GitHub
                    </a>
                </li>
                            </ul>
        </div>
    </div>
</header>


<main class="container-fluid">
    <div class="row">

        

        <nav id="sidebar" class="col-sm-3 col-lg-2" role="navigation">

            <ul class="nav nav-pills nav-stacked">
                                <li class="">
                    <a href="http://deib-polimi.github.io/tower4clouds/docs/">
                        Documentation Index
                    </a>
                </li>
                                                <li class="">
                    <a href="http://deib-polimi.github.io/tower4clouds/docs/overview.html">
                        Overview
                    </a>
                </li>
                                                <li class="">
                    <a href="http://deib-polimi.github.io/tower4clouds/docs/get-started.html">
                        Get started
                    </a>
                </li>
                                                <li class="">
                    <a href="http://deib-polimi.github.io/tower4clouds/docs/mosaic-installation.html">
                        Installation on mOSAIC
                    </a>
                </li>
                                                <li class="">
                    <a href="http://deib-polimi.github.io/tower4clouds/docs/data-collectors/">
                        Data Collectors
                    </a>
                </li>
                                                <li class="">
                    <a href="http://deib-polimi.github.io/tower4clouds/docs/manager/">
                        Manager
                    </a>
                </li>
                                                <li class="">
                    <a href="http://deib-polimi.github.io/tower4clouds/docs/data-analyzer/">
                        Data Analyzer
                    </a>
                </li>
                                                <li class="">
                    <a href="http://deib-polimi.github.io/tower4clouds/docs/model/">
                        The Model
                    </a>
                </li>
                                                <li class="">
                    <a href="http://deib-polimi.github.io/tower4clouds/docs/rules/">
                        Rules
                    </a>
                </li>
                                <ul class="submenu nav nav-stacked nav-pills">
                                        <li class="">
                        <a href="http://deib-polimi.github.io/tower4clouds/docs/rules/actions.html">
                            Actions
                        </a>
                    </li>

                                        <ul class="submenu nav nav-stacked nav-pills">
                                                <li class="active">
                            <a href="http://deib-polimi.github.io/tower4clouds/docs/rules/cloudmlcall.html">
                                CloudML Call
                            </a>
                        </li>

                                                <ul class="submenu nav nav-stacked nav-pills">
                                                    </ul>
                        
                                            </ul>
                    
                                    </ul>
                                                <li class="">
                    <a href="http://deib-polimi.github.io/tower4clouds/docs/observers/">
                        Observers
                    </a>
                </li>
                                                <li class="">
                    <a href="http://deib-polimi.github.io/tower4clouds/CHANGELOG.html">
                        Change log
                    </a>
                </li>
                                                <li class="">
                    <a href="http://deib-polimi.github.io/tower4clouds/CONTRIBUTING.html">
                        Contributing
                    </a>
                </li>
                                            </ul>

        </nav>

        
        <section id="content" class="col-sm-offset-3 col-lg-offset-2 col-sm-9 col-lg-10">
            <h1 id="cloudml-call">CloudML Call</h1>
<p>The CloudML Call action issues a command on a running CloudML daemon. For it to be working, then, there is to be a running daemon <em>before</em> registering the rule (as it checks when registering it if it's available or not).</p>
<h2 id="parameters">Parameters</h2>
<table>
<thead>
<tr>
<th>Name</th>
<th>Default value</th>
<th>Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ip</code></td>
<td>127.0.0.1</td>
<td>IP of the CloudML daemon</td>
</tr>
<tr>
<td><code>port</code></td>
<td>9030</td>
<td>Port of the CloudML daemon</td>
</tr>
<tr>
<td><code>command</code></td>
<td></td>
<td>Command that will be issued to CloudML (possible values: <code>SCALE</code>, <code>BURST</code>)</td>
</tr>
<tr>
<td><code>tier</code></td>
<td></td>
<td>Name of the tier that will be considered, as defined in the CloudML deploy model</td>
</tr>
<tr>
<td><code>n</code></td>
<td>1</td>
<td>Number of instances that will be considered (also negative numbers are allowed)</td>
</tr>
<tr>
<td><code>cooldown</code></td>
<td>600</td>
<td>The period (in seconds) on which the action will have to stay disabled after being issued</td>
</tr>
</tbody>
</table>
<p>Please notice that all the parameters with a default value could be omitted when registering the rule.</p>
<h2 id="example">Example</h2>
<p>This rule will scale up of 1 instance of the <code>HTTPAgent</code> when the <code>CPUUtilization</code> metric reaches the 0.8 threshold. After requesting the scale up, it will disable the rule for the cooldown period of 600 seconds (because that's what it takes to scale up on the provider it is being used), and enable it again right after that. The CloudML daemon is running on the same machine where the monitoring server is, and the port it is using is the default one, 9030.</p>
<pre><code class="language-xml">&lt;monitoringRules xmlns="http://www.modaclouds.eu/xsd/1.0/monitoring_rules_schema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.modaclouds.eu/xsd/1.0/monitoring_rules_schema"&gt;
  &lt;monitoringRule id="cpuUtilizationAboveRule" timeStep="180" timeWindow="180"&gt;
    &lt;monitoredTargets&gt;
      &lt;monitoredTarget class="VM" type="Frontend"/&gt;
    &lt;/monitoredTargets&gt;
    &lt;collectedMetric metricName="CPUUtilization"&gt;
      &lt;parameter name="samplingProbability"&gt;1&lt;/parameter&gt;
      &lt;parameter name="samplingTime"&gt;180&lt;/parameter&gt;
    &lt;/collectedMetric&gt;
    &lt;metricAggregation aggregateFunction="Average" groupingClass="CloudProvider"/&gt;
    &lt;condition&gt;METRIC &amp;gt;= 0.8&lt;/condition&gt;
    &lt;actions&gt;
      &lt;action name="CloudMLCall"&gt;
        &lt;parameter name="ip"&gt;127.0.0.1&lt;/parameter&gt;
        &lt;parameter name="port"&gt;9030&lt;/parameter&gt;
        &lt;parameter name="command"&gt;SCALE&lt;/parameter&gt;
        &lt;parameter name="tier"&gt;HTTPAgent&lt;/parameter&gt;
        &lt;parameter name="n"&gt;1&lt;/parameter&gt;
        &lt;parameter name="cooldown"&gt;600&lt;/parameter&gt;
      &lt;/action&gt;
    &lt;/actions&gt;
  &lt;/monitoringRule&gt;
&lt;/monitoringRules&gt;</code></pre>
<p>Another example, calling directly the <code>BURST</code> command and skipping all the parameters for which we want to use the defaults is this one:</p>
<pre><code class="language-xml">&lt;monitoringRules xmlns="http://www.modaclouds.eu/xsd/1.0/monitoring_rules_schema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.modaclouds.eu/xsd/1.0/monitoring_rules_schema"&gt;
  &lt;monitoringRule id="cpuUtilizationAboveRule2" timeStep="180" timeWindow="180"&gt;
    &lt;monitoredTargets&gt;
      &lt;monitoredTarget class="VM" type="Frontend"/&gt;
    &lt;/monitoredTargets&gt;
    &lt;collectedMetric metricName="CPUUtilization"&gt;
      &lt;parameter name="samplingProbability"&gt;1&lt;/parameter&gt;
      &lt;parameter name="samplingTime"&gt;180&lt;/parameter&gt;
    &lt;/collectedMetric&gt;
    &lt;metricAggregation aggregateFunction="Average" groupingClass="CloudProvider"/&gt;
    &lt;condition&gt;METRIC &amp;gt;= 0.95&lt;/condition&gt;
    &lt;actions&gt;
      &lt;action name="CloudMLCall"&gt;
        &lt;parameter name="command"&gt;BURST&lt;/parameter&gt;
        &lt;parameter name="tier"&gt;HTTPAgent&lt;/parameter&gt;
      &lt;/action&gt;
    &lt;/actions&gt;
  &lt;/monitoringRule&gt;
&lt;/monitoringRules&gt;</code></pre>
<h2 id="example-of-cloudml-deploy-model">Example of CloudML Deploy Model</h2>
<p>A deploy model that would work with the rules above is the one provided here, where two providers are being used (Flexiant and Amazon). To specify which one is the matching machine type on both the providers, this name pattern is used: both vms have the same prefix, <code>HTTPAgent</code>, but each of them has a suffix that is <code>@Provider</code>, either <code>@Amazon</code> or <code>@Flexiant</code> then. In the rule above, we used only the common prefix, <code>HTTPAgent</code>, as the name of the tier.</p>
<p>That is the only thing needed for the action to work, you can keep using the CloudML model you were already using. Of course, if you're going to use just one provider, you don't need to abide to this name convention.</p>
<pre><code class="language-json">{
  "eClass": "net.cloudml.core:CloudMLModel",
  "name": "CloudMLCallTest",
  "providers": [
    {
      "eClass": "net.cloudml.core:Provider",
      "credentials": "credentialsAmazon.properties",
      "name": "aws-ec2",
      "properties": [
        {
          "eClass": "net.cloudml.core:Property",
          "name": "MaxVMs",
          "value": "5"
        }
      ]
    },
    {
      "eClass": "net.cloudml.core:Provider",
      "credentials": "credentialsFlexiant.properties",
      "name": "flexiant",
      "properties": [
        {
          "eClass": "net.cloudml.core:Property",
          "name": "MaxVMs",
          "value": "5"
        },
        {
          "eClass": "net.cloudml.core:Property",
          "name": "endPoint",
          "value": "https://api.sd1.flexiant.net:4442/userapi"
        }
      ]
    }
  ],
  "internalComponents": [
    {
      "eClass": "net.cloudml.core:InternalComponent",
      "name": "app",
      "resources": [
        {
          "eClass": "net.cloudml.core:Resource",
          "name": "startApp",
          "downloadCommand": "cd ~ &amp;&amp; curl -O https://raw.githubusercontent.com/deib-polimi/modaclouds-tests/master/machines/downloadEverything.sh &amp;&amp; bash /home/ubuntu/downloadEverything.sh HTTPAgent",
          "installCommand": "bash /home/ubuntu/installEverything",
          "startCommand": "sudo bash /home/ubuntu/startHTTPAgent [mmIp] [mmPort]",
        }
      ],
      "requiredExecutionPlatform": {
        "eClass": "net.cloudml.core:RequiredExecutionPlatform",
        "name": "appRequired",
        "owner": "internalComponents[app]"
      },
      "properties" : [
        {
          "eClass": "net.cloudml.core:Property",
          "name": "env:MODACLOUDS_TOWER4CLOUDS_CLOUD_PROVIDER_ID",
          "value": "${this.provider.id}"
        }
      ]
    }
  ],
  "internalComponentInstances": [
    {
      "eClass": "net.cloudml.core:InternalComponentInstance",
      "name": "appInstance",
      "type": "internalComponents[app]",
      "requiredExecutionPlatformInstance": {
        "eClass": "net.cloudml.core:RequiredExecutionPlatformInstance",
        "name": "appRequiredInstance",
        "owner": "internalComponentInstances[appInstance]",
        "type": "internalComponents[app]/requiredExecutionPlatform[appRequired]"
      }
    }
  ],
  "vms": [
    {
      "eClass": "net.cloudml.core:VM",
      "is64os": true,
      "location": "us-west-1",
      "providerSpecificTypeName": "m3.large",
      "minRam": "7680",
      "maxRam": "0",
      "minCores": "2",
      "maxCores": "0",
      "minStorage": "8",
      "maxStorage": "0",
      "name": "HTTPAgent@Amazon",
      "os": "ubuntu",
      "privateKey": "desantis-ireland.pem",
      "provider": "providers[aws-ec2]",
      "securityGroup": "default",
      "sshKey": "desantis-ireland",
      "providedExecutionPlatforms": [
        {
          "eClass": "net.cloudml.core:ProvidedExecutionPlatform",
          "name": "HTTPAgentTIERAmazon",
          "owner": "vms[HTTPAgent@Amazon]",
          "offers": [
            {
              "eClass": "net.cloudml.core:Property",
              "name": "OS",
              "value": "Ubuntu"
            }
          ]
        }
      ]
    },
    {
      "eClass": "net.cloudml.core:VM",
      "imageId": "Ubuntu 14.04 (Cluster Two)",
      "is64os": true,
      "minRam": "4000",
      "maxRam": "0",
      "minCores": "2",
      "maxCores": "0",
      "minStorage": "50",
      "maxStorage": "0",
      "name": "HTTPAgent@Flexiant",
      "os": "ubuntu",
      "privateKey": "polimi-review-2014.pem",
      "groupName": "Polimi CEPH Cluster",
      "provider": "providers[flexiant]",
      "securityGroup": "all",
      "sshKey": "polimi-review-2014",
      "providedExecutionPlatforms": [
        {
          "eClass": "net.cloudml.core:ProvidedExecutionPlatform",
          "name": "HTTPAgentTIERFlexiant",
          "owner": "vms[HTTPAgent@Flexiant]",
          "offers": [
            {
              "eClass": "net.cloudml.core:Property",
              "name": "OS",
              "value": "Ubuntu"
            }
          ]
        }
      ]
    }
  ],
  "vmInstances": [
    {
      "eClass": "net.cloudml.core:NodeInstance",
      "name": "HTTPAgentInstance",
      "type": "vms[HTTPAgent@Flexiant]",
      "providedExecutionPlatformInstances": [
        {
          "eClass": "net.cloudml.core:ProvidedExecutionPlatformInstance",
          "name": "HTTPAgentTier",
          "owner": "vmInstances[HTTPAgentInstance]",
          "type": "vms[HTTPAgent@Flexiant]/providedExecutionPlatforms[HTTPAgentTIERFlexiant]"
        }
      ]
    }
  ],
  "executesInstances": [
    {
      "eClass": "net.cloudml.core:ExecuteInstance",
      "name": "runApp",
      "providedExecutionPlatformInstance": "vmInstances[HTTPAgentInstance]/providedExecutionPlatformInstances[HTTPAgentTier]",
      "requiredExecutionPlatformInstance": "internalComponentInstances[appInstance]/requiredExecutionPlatformInstance[appRequiredInstance]"
    }
  ]
}</code></pre>
        </section>

    </div>
</main>



<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
<script src="http://yastatic.net/highlightjs/8.2/highlight.min.js"></script>

<script>
    $(function() {
        $("section>h1").wrap('<div class="page-header" />');
        // Syntax highlighting
        hljs.initHighlightingOnLoad();
    });
</script>


</body>
</html>
